<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Qu·∫£n L√Ω L√¨ X√¨ Real-time</title>
    <style>
      :root {
        --red: #d40000;
        --gold: #ffdf00;
      }
      body {
        font-family: "Segoe UI", sans-serif;
        background: #f4f7f6;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .header-box {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid var(--red);
        padding-bottom: 15px;
        margin-bottom: 20px;
      }
      h1 {
        color: var(--red);
        margin: 0;
        font-size: 1.5rem;
      }

      .status-bar {
        font-size: 0.8rem;
        color: #666;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .dot {
        height: 10px;
        width: 10px;
        background-color: #2ecc71;
        border-radius: 50%;
        display: inline-block;
        animation: blink 1s infinite;
      }

      @keyframes blink {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
        100% {
          opacity: 1;
        }
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background-color: #fff5f5;
        color: var(--red);
        font-weight: bold;
      }

      .new-row {
        animation: highlight 2s ease-out;
      }
      @keyframes highlight {
        from {
          background-color: #fff9c4;
        }
        to {
          background-color: transparent;
        }
      }

      .amount {
        font-weight: bold;
        color: #27ae60;
      }
      .time-tag {
        font-size: 0.75rem;
        color: #888;
        background: #eee;
        padding: 2px 6px;
        border-radius: 4px;
      }
      .empty-msg {
        text-align: center;
        padding: 40px;
        color: #999;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header-box">
        <h1>üßß H·ªÜ TH·ªêNG L√å X√å 2026</h1>
        <div class="status-bar">
          <span class="dot"></span> ƒêang t·ª± ƒë·ªông c·∫≠p nh·∫≠t (3s)...
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Th·ªùi gian</th>
            <th>Ng∆∞·ªùi nh·∫≠n</th>
            <th>Ng√¢n h√†ng</th>
            <th>S·ªë t√†i kho·∫£n</th>
            <th>S·ªë ti·ªÅn</th>
          </tr>
        </thead>
        <tbody id="data-table"></tbody>
      </table>
    </div>

    <script>
      let lastDataCount = 0;

      async function fetchData() {
        try {
          const response = await fetch("/api/admin/list");
          const data = await response.json();

          // Ch·ªâ c·∫≠p nh·∫≠t giao di·ªán n·∫øu s·ªë l∆∞·ª£ng d·ªØ li·ªáu thay ƒë·ªïi
          if (data.length !== lastDataCount) {
            renderTable(data);

            // N·∫øu c√≥ d·ªØ li·ªáu m·ªõi (kh√¥ng ph·∫£i l·∫ßn t·∫£i ƒë·∫ßu ti√™n), ph√°t √¢m thanh th√¥ng b√°o nh·∫π
            if (lastDataCount !== 0 && data.length > lastDataCount) {
              console.log("C√≥ l·ªôc m·ªõi!");
              // B·∫°n c√≥ th·ªÉ th√™m audio.play() ·ªü ƒë√¢y n·∫øu mu·ªën
            }
            lastDataCount = data.length;
          }
        } catch (error) {
          console.error("L·ªói c·∫≠p nh·∫≠t:", error);
        }
      }

      function renderTable(data) {
        const tbody = document.getElementById("data-table");

        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5" class="empty-msg">Ch∆∞a c√≥ ai nh·∫≠p th√¥ng tin...</td></tr>`;
          return;
        }

        // S·∫Øp x·∫øp m·ªõi nh·∫•t l√™n ƒë·∫ßu
        const html = data
          .reverse()
          .map(
            (item, index) => `
            <tr class="${index === 0 && lastDataCount !== 0 ? "new-row" : ""}">
                <td><span class="time-tag">${item.time}</span></td>
                <td><strong>${item.name}</strong></td>
                <td>${item.bank}</td>
                <td><code>${item.account}</code></td>
                <td><span class="amount">${item.amount}</span></td>
            </tr>
        `,
          )
          .join("");

        tbody.innerHTML = html;
      }

      // Ch·∫°y ngay l·∫≠p t·ª©c khi m·ªü trang
      fetchData();

      // Thi·∫øt l·∫≠p v√≤ng l·∫∑p t·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói 3000ms (3 gi√¢y)
      setInterval(fetchData, 3000);
    </script>
  </body>
</html>
